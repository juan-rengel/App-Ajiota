<!doctype html>

<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>controle — Registro de Empréstimos</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{margin:0;padding:24px;background:linear-gradient(180deg,#071029 0%, #071827 100%);color:#e6eef6}
    .container{max-width:960px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    form .row{display:flex;gap:10px;margin-bottom:10px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number], input[type=date], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:10px;color:#042028;cursor:pointer;font-weight:600}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px 6px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:14px}
    .right{text-align:right}
    .big-total{font-size:26px;font-weight:700;color:#fff}
    .muted{color:var(--muted);font-size:13px}
    .actions button{margin-right:6px;background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);padding:6px;border-radius:8px;cursor:pointer}
    .explain{font-size:13px;color:var(--muted);line-height:1.45;margin-top:8px}
    .filters{display:flex;gap:8px;align-items:center;margin-top:8px}
    .small{font-size:12px;padding:6px 8px}
    footer{margin-top:14px;color:var(--muted);font-size:12px}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}.container{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>controle — Registro de Empréstimos</h1>
        <p class="lead">Registre quem recebeu o dinheiro, o valor e acompanhe o acúmulo total.</p>
      </div>
    </header><div class="grid">
  <section class="card">
    <form id="loanForm">
      <div class="row">
        <div style="flex:2">
          <label for="name">Nome da pessoa</label>
          <input id="name" type="text" placeholder="Ex: João da Silva" required />
        </div>
        <div style="flex:1">
          <label for="amount">Valor (R$)</label>
          <input id="amount" type="number" step="0.01" min="0" placeholder="100.00" required />
        </div>
      </div>

      <div class="row">
        <div style="flex:1">
          <label for="date">Data</label>
          <input id="date" type="date" />
        </div>
        <div style="flex:1">
          <label for="tag">Tag (opcional)</label>
          <input id="tag" type="text" placeholder="Ex: curto prazo" />
        </div>
      </div>

      <div>
        <label for="note">Observação (opcional)</label>
        <textarea id="note" rows="2" placeholder="Anotações..."></textarea>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div class="muted">Campos obrigatórios: Nome e Valor</div>
        <div>
          <button type="submit">Adicionar empréstimo</button>
        </div>
      </div>
    </form>

    <div style="margin-top:14px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="muted">Total emprestado</div>
          <div id="total" class="big-total">R$ 0,00</div>
          <div class="muted" id="count">0 empréstimos</div>
        </div>
        <div style="text-align:right">
          <div class="muted">Média por empréstimo</div>
          <div id="avg" class="big-total">R$ 0,00</div>
        </div>
      </div>

      <div class="filters">
        <label>Pesquisar:</label>
        <input id="search" type="text" class="small" placeholder="Nome ou tag" />
        <label>Filtrar data:</label>
        <input id="from" type="date" class="small" />
        <input id="to" type="date" class="small" />
        <button id="clearFilters" class="small">Limpar</button>
      </div>

      <table id="loansTable">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Valor</th>
            <th>Data</th>
            <th>Tag</th>
            <th class="right">Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

    </div>
  </section>

  <aside class="card">
    <h3>Como funciona o acúmulo total</h3>
    <p class="explain">Cada vez que você registra um empréstimo com o <strong>Nome</strong> e o <strong>Valor</strong>, o sistema soma esse valor ao <em>Total emprestado</em>. O painel mostra:</p>
    <ul class="explain">
      <li><strong>Total emprestado:</strong> soma de todos os valores registrados (R$).</li>
      <li><strong>Quantidade:</strong> número total de empréstimos registrados.</li>
      <li><strong>Média por empréstimo:</strong> total dividido pela quantidade — útil para ver o ticket médio.</li>
    </ul>
    <p class="explain">Você pode filtrar por nome/tag e por período (datas). O cálculo do total respeita os filtros aplicados — assim você vê o total apenas para o conjunto exibido.</p>

    <hr style="border:none;border-top:1px dashed rgba(255,255,255,0.04);margin:12px 0" />

    <div style="display:flex;gap:8px;flex-direction:column">
      <button id="exportCsv">Exportar CSV</button>
      <button id="clearAll" style="background:#ffb86b;color:#2b1300">Limpar todos os registros</button>
    </div>

    <footer>
      Dica: abra este arquivo localmente no navegador. Os dados são salvos no armazenamento local do navegador (localStorage).
    </footer>
  </aside>
</div>

  </div>  <script>
    // util
    const currency = v => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);
    const $ = id => document.getElementById(id);

    let loans = JSON.parse(localStorage.getItem('ajiotas_loans') || '[]');

    const save = () => localStorage.setItem('ajiotas_loans', JSON.stringify(loans));

    function uid(){return Date.now().toString(36) + Math.random().toString(36).slice(2,7)}

    function render(filter={}){
      const tbody = document.querySelector('#loansTable tbody');
      tbody.innerHTML='';

      // apply filters: search, date range
      const q = ($('search').value || '').toLowerCase();
      const from = $('from').value ? new Date($('from').value) : null;
      const to = $('to').value ? new Date($('to').value) : null;

      const filtered = loans.filter(l => {
        if(q){
          const inText = (l.name + ' ' + (l.tag||'') + ' ' + (l.note||'')).toLowerCase();
          if(!inText.includes(q)) return false;
        }
        if(from){
          const d = new Date(l.date);
          if(d < from) return false;
        }
        if(to){
          const d = new Date(l.date);
          // include the 'to' day
          const toEnd = new Date(to); toEnd.setHours(23,59,59,999);
          if(d > toEnd) return false;
        }
        return true;
      });

      // totals
      const total = filtered.reduce((s,cur)=> s + Number(cur.amount),0);
      const count = filtered.length;
      const avg = count ? total / count : 0;


      // rows
      filtered.sort((a,b)=> new Date(b.date) - new Date(a.date));
      for(const l of filtered){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${escapeHtml(l.name)}<div class="muted" style="font-size:12px">${escapeHtml(l.note||'')}</div></td>
          <td>${currency(Number(l.amount))}</td>
          <td>${new Date(l.date).toLocaleDateString('pt-BR')}</td>
          <td>${escapeHtml(l.tag||'')}</td>
          <td class="right actions">
            <button data-id="${l.id}" class="edit">Editar</button>
            <button data-id="${l.id}" class="del">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      }

      // attach actions
      document.querySelectorAll('.del').forEach(b=> b.onclick = e => {
        const id = e.target.dataset.id; if(!confirm('Excluir este registro?')) return;
        loans = loans.filter(x=> x.id !== id); save(); render();
      });

      document.querySelectorAll('.edit').forEach(b=> b.onclick = e => {
        const id = e.target.dataset.id; const item = loans.find(x=> x.id === id); if(!item) return;
        $('name').value = item.name; $('amount').value = item.amount; $('date').value = item.date.slice(0,10); $('tag').value = item.tag||''; $('note').value = item.note||'';
        // remove item being edited and allow re-add
        loans = loans.filter(x=> x.id !== id); save(); render();
      });
    }

    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // form submit
    $('loanForm').addEventListener('submit', e => {
      e.preventDefault();
      const name = $('name').value.trim();
      const amount = parseFloat($('amount').value);
      const date = $('date').value || (new Date()).toISOString();
      const tag = $('tag').value.trim();
      const note = $('note').value.trim();
      if(!name || !amount || isNaN(amount) || amount <= 0){ alert('Preencha nome e valor válidos.'); return; }

      loans.push({ id: uid(), name, amount: amount.toFixed(2), date, tag, note });
      save();
      $('loanForm').reset();
      render();
    });

    // filters
    $('search').addEventListener('input', render);
    $('from').addEventListener('change', render);
    $('to').addEventListener('change', render);
    $('clearFilters').addEventListener('click', ()=>{ $('search').value=''; $('from').value=''; $('to').value=''; render(); });

    // export CSV
    $('exportCsv').addEventListener('click', ()=>{
      if(!loans.length){ alert('Sem registros para exportar.'); return; }
      const rows = [['id','name','amount','date','tag','note']];
      for(const l of loans) rows.push([l.id, l.name, l.amount, l.date, l.tag||'', l.note||'']);
      const csv = rows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'ajiotas_export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // clear all
    $('clearAll').addEventListener('click', ()=>{
      if(!confirm('Apagar todos os registros? Esta ação é irreversível.')) return;
      loans = []; save(); render();
    });

    // initial render
    if(!loans.length){ // ensure date fields for empty dataset default to today for entries when adding
      // no-op
    }
    render();
  </script></body>
</html>