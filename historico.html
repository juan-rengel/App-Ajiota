<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ§¾ HistÃ³rico de Pagamentos</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- ===== MENU LATERAL ===== -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <h2>ğŸ’° MOB</h2>
    <button id="closeMenu" class="close-btn">Ã—</button>
  </div>
  <ul>
    <li><a href="index.html">ğŸ  Home</a></li>
    <li><a href="dashboard.html">ğŸ“Š Dashboard</a></li>
    <li><a href="#">ğŸ’° EmprÃ©stimos</a></li>
    <li><a href="historico.html" class="active">ğŸ§¾ HistÃ³rico</a></li>
    <li><a href="#">âš™ï¸ ConfiguraÃ§Ãµes</a></li>
  </ul>
</nav>

<!-- ===== TOPO ===== -->
<header class="topbar">
  <button id="openMenu" class="menu-btn">â˜°</button>
  <h1>HistÃ³rico de Pagamentos</h1>
  <button id="toggleThemeBtn" class="theme-btn">ğŸŒ™</button>
</header>

<!-- ===== CONTEÃšDO PRINCIPAL ===== -->
<main class="container">
  <h2>ğŸŸ¢ EmprÃ©stimos Pagos</h2>
  <div id="paidList" class="loan-list"></div>

  <hr style="margin:30px 0; border:0; border-top:1px solid #ccc;">

  <h2>ğŸŸ¡ EmprÃ©stimos Abertos</h2>
  <div id="openList" class="loan-list"></div>
</main>

<!-- ===== TOAST DE NOTIFICAÃ‡ÃƒO ===== -->
<div id="toast" class="toast"></div>

<script>
// ========= LER DADOS =========
const loansData = JSON.parse(localStorage.getItem('loansData')) || [];
const loanHistory = JSON.parse(localStorage.getItem('loanHistory')) || [];
const paidList = document.getElementById('paidList');
const openList = document.getElementById('openList');
const toast = document.getElementById('toast');

// ========= FUNÃ‡Ã•ES =========
function showToast(message) {
  toast.textContent = message;
  toast.className = "toast show";
  setTimeout(() => (toast.className = toast.className.replace("show", "")), 3000);
}

// Renderizar listas
function renderHistory() {
  paidList.innerHTML = '';
  openList.innerHTML = '';

  // PAGOS
  if (loanHistory.length === 0) {
    paidList.innerHTML = '<p class="empty">Nenhum emprÃ©stimo pago ainda.</p>';
  } else {
    loanHistory.forEach((loan, index) => {
      const totalWithInterest = loan.amount * (1 + (loan.interest / 100) * loan.days);
      const card = document.createElement('div');
      card.className = 'loan-card';
      card.innerHTML = `
        <div class="card-header">
          <h3>${loan.name}</h3>
          <p>ğŸ“ ${loan.phone || 'Sem telefone'}</p>
        </div>
        <div class="card-body">
          <p><strong>Valor:</strong> R$ ${loan.amount.toFixed(2)}</p>
          <p><strong>Juros:</strong> ${loan.interest}% ao dia</p>
          <p><strong>Total pago:</strong> R$ ${totalWithInterest.toFixed(2)}</p>
          <p><strong>Data de Pagamento:</strong> ${loan.paidDate}</p>
        </div>
        <div class="card-actions">
          <button class="delete-btn" onclick="removePaid(${index})">ğŸ—‘ï¸ Remover</button>
          <button class="pay-btn" onclick="reopenLoan(${index})">â†©ï¸ Reabrir</button>
        </div>
      `;
      paidList.appendChild(card);
    });
  }

  // ABERTOS
  if (loansData.length === 0) {
    openList.innerHTML = '<p class="empty">Nenhum emprÃ©stimo em aberto.</p>';
  } else {
    loansData.forEach((loan, index) => {
      const totalWithInterest = loan.amount * (1 + (loan.interest / 100) * loan.days);
      const dueDate = new Date(loan.date);
      dueDate.setDate(dueDate.getDate() + loan.days);
      const daysLeft = Math.ceil((dueDate - new Date()) / (1000 * 60 * 60 * 24));

      const card = document.createElement('div');
      card.className = 'loan-card';
      card.innerHTML = `
        <div class="card-header">
          <h3>${loan.name}</h3>
          <p>ğŸ“ ${loan.phone || 'Sem telefone'}</p>
        </div>
        <div class="card-body">
          <p><strong>Valor:</strong> R$ ${loan.amount.toFixed(2)}</p>
          <p><strong>Juros:</strong> ${loan.interest}% ao dia</p>
          <p><strong>Restam:</strong> ${daysLeft} dias</p>
          <p><strong>Total:</strong> R$ ${totalWithInterest.toFixed(2)}</p>
        </div>
      `;
      openList.appendChild(card);
    });
  }
}

// Reabrir emprÃ©stimo pago
function reopenLoan(index) {
  const loan = loanHistory[index];
  if (!confirm(`Deseja reabrir o emprÃ©stimo de ${loan.name}?`)) return;
  loansData.push(loan);
  loanHistory.splice(index, 1);
  localStorage.setItem('loansData', JSON.stringify(loansData));
  localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
  renderHistory();
  showToast(`ğŸ”„ EmprÃ©stimo de ${loan.name} reaberto.`);
}

// Remover do histÃ³rico
function removePaid(index) {
  if (!confirm('Remover este registro do histÃ³rico?')) return;
  loanHistory.splice(index, 1);
  localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
  renderHistory();
  showToast('ğŸ—‘ï¸ Registro removido do histÃ³rico.');
}

// ========= MODO ESCURO =========
const toggleThemeBtn = document.getElementById('toggleThemeBtn');
const body = document.body;
const currentTheme = localStorage.getItem('theme') || 'dark';
body.classList.toggle('dark', currentTheme === 'dark');
toggleThemeBtn.textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';

toggleThemeBtn.addEventListener('click', () => {
  body.classList.toggle('dark');
  const theme = body.classList.contains('dark') ? 'dark' : 'light';
  localStorage.setItem('theme', theme);
  toggleThemeBtn.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
});

// ========= MENU LATERAL =========
const sidebar = document.getElementById('sidebar');
document.getElementById('openMenu').addEventListener('click', () => {
  sidebar.classList.add('open');
});
document.getElementById('closeMenu').addEventListener('click', () => {
  sidebar.classList.remove('open');
});

// ========= INICIALIZAÃ‡ÃƒO =========
renderHistory();
</script>
</body>
</html>
